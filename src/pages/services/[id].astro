---
import Layout from "../../layouts/Layout.astro";
import { getServices } from "../../services/services";
import { marked } from "marked";

export async function getStaticPaths() {
  const services = await getServices();
  return Array.from(services.values()).map((service) => ({
    params: {
      id: service.id,
    },
    props: {
      service: service,
    },
  }));
}

const services = await getServices();
const { id } = Astro.params;
const { service } = Astro.props;
---

<Layout title={service.name}>
  <main class="container mx-auto py-10">
    <article class="bg-white shadow-md rounded-xl p-10 max-w-5xl mx-auto">
      <h1 class="text-5xl font-extrabold">{service.name}</h1>
      <span class="block text-sm mb-3"
        >{
          new Date(service.last_updated).toLocaleDateString("de-CH", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }</span
      >
      <div set:html={marked.parse(service.description)} />

      <dl class="mb-4 mt-3">
        <dt class="font-bold">Links</dt>
        <dd>
          <ul class="list-disc ps-5">
            {
              service.links.map((link) => (
                <li>
                  <a class="text-brombeer hover:underline" href={link.url}>
                    {link.label}
                  </a>
                </li>
              ))
            }
          </ul>
        </dd>
      </dl>

      <dl class="mb-4 mt-3">
        <dt class="font-bold">Steckbrief</dt>
        <dd set:html={marked.parse(service.strategy_reference)} />
      </dl>

      <dl class="mb-4 mt-3">
        <dt class="font-bold">Abh√§ngigkeiten</dt>
        <dd>
          <ul class="list-disc ps-5">
            {
              service.relations?.map((relation) => {
                const relatedService = services.get(relation.service);
                return (
                  <li>
                    {relation.description}:{" "}
                    <a class="text-brombeer hover:underline" href={`/services/${relatedService.id}`}>
                      {relatedService.name}
                    </a>
                    <span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded">
                      {relation.relation_criticality}
                    </span>
                  </li>
                );
              })
            }
          </ul>
        </dd>
      </dl>
    </article>
  </main>
</Layout>
